# 第八节课 - Vue-Router

## 安装项目

为了更好地做项目，这次再进行一次移植，再进入 Vue-Router。大公司都是这么做的，今天老师就带着大家来学习一下。已经有人用 webpack 帮大家做好了架构，所以大家直接拿来用就可以了。

> 老师现在要求前端团队的四个工程师全都学习 Vue，所以还需要招一个中级以上的工程师，带领团队切换到 Vue 这个技术栈。尴尬的是，用传统的开发方式的效率很低，老师在周末布置了一个作业，让前端自学 Vue，以便快速开展工作。

先用 vue-template 中的命令创建一个空项目，过年期间 Vue 发生了一些变化，所以大家需要重新安装一下 vue-cli。老师也是昨天才发现的，因为指令不好用了，所以才注意到这个问题。

安装完成之后，有几个选项要注意：初始化项目的指令是 `vue init webpack my-project2`，初始化时会提示对一些选项进行配置，其中有一个运行时编译，就是是否要实时显示最新的代码效果（选第一个）；而且还会提示是否要装 vue-router，这个时候就要考虑一下自己的前端项目是否有至少两个以上的页面，是的话就要装；至于 ESLint，大家如果不熟悉就选 no，这样写代码的时候就比较轻松一些，不然会花大量时间按照编码规范去调试代码，但是以后在写公司级项目的时候，还是要尽量开启这个选项；单元测试在做小项目的时候可以不开启，e2e 测试也可以不开启；最后还可以选择是否立即安装包（可选 NPM 或者 Yarn，老师倾向于后者），接着就会开始安装项目。

在安装的过程中，可以用 Visual Diff 查看两种方式创建的项目，在目录结构上有什么区别。一般来说，在用 Diff 比较项目代码的时候，会删掉 `node_modules` 这个文件夹，或者忽略它，因为它体积太大，比较代码差异的时候会非常慢。

安装完成后，用 `cd` 命令进入项目目录，直接执行 `npm run dev`，编译完成后就会在浏览器中启动项目。

但是！安装完成之后，`src` 文件夹是空的，什么鬼？也不知道是怎么解决的。等到终端中显示什么 `localhost:8080` 的时候，就说明项目已经编译完成，可以在浏览器中查看页面了。

## 了解项目

用 VSCode 打开项目，整个项目的结构和 vue-cli 创建出来的是差不多的，需要重点关注的有几方面。

先来看看 `package.json`，可以看到里面多了一个 `vue-router`，是因为之前选择了安装它，关键在于开发依赖这一侧多了几个和 webpack 相关的库，说明这个项目是通过 webpack 打包的，和之前 vue-cli 不一样，用了 webpack 功能会更强大一点。

最重要的是 `src` 文件夹，先看看 `main.js`，一般来说，看到了 `main` 就意味着找到了程序的入口。不用 care 它是什么时候执行的，知道它是项目的核心就可以了。文件中的代码很少，但是要知道几点：先是用 `import` 引入文件，然后 `new` 了一个 Vue 对象，那么这个对象在哪里使用呢？是在 `index.html` 中使用它的。这个 HTML 文件我们很熟悉，其中最关键的就是那一行注释，表示对象会被插入到这个位置。至于是如何插入的，项目都给我们做好了。`src` 中的诸多文件最终会打包成一个完整的文件，插入到 `index.html` 中所标记的位置。那么 `main.js` 自然最终也会被打包到 HTML 文件中去。

在学 Vue 的时候，文档中说了一句话，要尽量保证前端的文件中只有一个 Vue 根对象，也就是 `main.js` 这里的这个对象。`router` 文件夹中也有一个选项对象，最终会放到 Vue 根对象中。

看看 `router/index.js` 这个文件，`import` 命令中有一个 `@` 指令，是为了方便访问。有的时候用的是组件，总是需要去关注相对路径，那么在配置项目时就希望把一些常用路径放到全局的位置，随时调用，`@/components` 就是这个含义。那么这些常用路径要在哪里配置呢？待会儿再找吧。

`route` 这个配置对象是一个数组，我们可以尝试着给它加一个选项：

```javascript
[
  {...},
  {
    path: '/Homepage',
    name: 'HelloVue',
    component: HelloVue
  }
]
```

新增了这个路由选项之后，再准备一个对应的组件，写上不同的内容，这样能和另一个组件有所区分。

VUe 在 `main.js` 中 `import` 了 `router` 这个路由配置对象，有没有觉得和 Express.js 很像？使用方法也很简单，一个 `path` 对应一个 `component` 即可。有了这个 `path`，就能够展示对应的 `component` 了。这样再也不用麻烦服务端的小哥哥了，他们只需要提供数据就好了。

有了 router 之后，如何进行代码级别的操作呢？先把项目编译一下。

题外话：需要编译项目的时候，对电脑的配置要求会比较高一些，还是买台性能比较好的电脑吧。

有了 vue-router 之后，是通过代码来跳转页面的，这就是前端的能力。在以前是用传统的超链接的方式来跳转页面，是因为之前都是向服务器请求页面的。但是现在有了前端路由，就用不到超链接了。那么应该用什么样的方式跳转呢？用 `router.push(path)`，这样就能够跳到对应的页面。那么 `router` 是什么？其实就是 `router/index.js` 中的内容，其中有代码 `export default new VueRouter({...})`，导出了一个 VueRouter 对象，然后在组件中引入 `router`，这样就能在组件中实现页面之间的跳转了。

能够看到有几个变化：`path` 的路由改变了，在浏览器中前进/后退也都是能够在页面历史之间来回跳转的。传统的超链接的前后跳转，用的是 `windows.go()` 之类的指令。用 vue-router 的话，要跳转到前一个页面，用 `router.pop()` 就可以了。

Express 和 Vue 都有路由，但构不成竞争。Express 架构强大的能力，和 Vue 完全不是一码事。Express 是一个服务端的架构，提供页面只是它的能力之一。Express 不管是提供数据还是提供页面，用的都是 router。所以两者其实不是一回事。

等等，`router.pop()` 不管用，那就看看文档，原来应该用 `router.go(-1)`，这下页面的前进后退就没问题了。

学会了 vue-router 之后，就可以开发跟手机 APP 一样的项目了。GitHub 上有饿了么前端团队开发的 mint-ui 这个搭配 Vue 的 UI 框架，直接在当前项目根目录执行 `yarn add mint-ui` 安装框架。滴滴 APP 中的很多页面也是通过这种方式在 H5 页面中实现的，今天老师讲的内容也是在自己的实际项目中要做的。安装完成之后，要怎么引入呢？当然是照着官方文档上的方法，在主函数 `main` 中引入，然后就可以使用了。

有了 mint-ui 就可以把组件中的样式全部干掉，直接用 mint-ui 提供的样式就可以了。先不急着用，先上官网看一下各个功能的实际效果。其实它是把各种 CSS 样式打包成了一个个组件，在手机上进行使用。

接下来学习老师是如何改造自己的项目的，用 `import` 指令单独引入 `cell` 组件，如果希望组件只在当前文件中使用，不要用 `Vue.component` 指令，而应该在选项对象中用 `components` 引入。这个时候编译代码，发现当前页面中显示的 `cell` 和官网实例的效果不一样，文字偏细，并且居中显示。既然出了问题，就来分析问题。首先，CSS 的引用没有问题，因为基本的效果已经出来了，如果 CSS 文件引用失败的话，就应该完全没有效果。那么问题在哪里呢？虽然导入了 CSS 文件，但是组件的最外层应该是还得加一个 `class`，这样才能保证组件的显示效果统一化。应该加个什么 `class` 呢？直接看官网 DEMO 的源码就好了嘛。官网的源码中，最外层的 `div` 有一个类名 `page-cell`，照着加进来，编译代码，还是不对！这就很尴尬了。那就试试另一种解决方式，直接看源码，看看当前元素的 CSS 样式是由哪些文件决定的，啊哈，发现 `#app` 也影响了当前按钮的样式，删掉组件中对应的样式代码，问题解决了，棒！

现在再点击修改后的按钮，发现点不动，这是为啥？看官网文档，这个 `cell` 组件可以 `to` 到一个 URL，那么是不是可以传入一个 `path`，跳转到对应的位置呢？还真的可以，这只是徐老师的一个推测，因为用过类似的库，所以知道它的设计思路是什么样的。`to` 后面跟的是 `//github.com` 这样的地址，说明可以实现路由跳转（听直播时没跟上进度，此处表述可能不正确）。

现在把 icon 干掉，然后如果再把样式设计得好看一些的话，有没有觉得就是在开发手机上的原生应用？其实公众号、小程序里面实现的都是类似的东西，开发模式和它也是一样的。

作业：用 vue-router + mint-ui + webpack 实现项目的创建，路由的跳转，和 UI 组件的使用这三个作业。

今天太卡了，老师就不多讲了，不然大家会损失好几个亿。本来是想把 task 项目移植过来，让大家学习一下的。既然这么卡，老师就把项目传到 GitHub 上，到时候大家好好学习一下。

虽然 Vue 和 Express 的路由不太一样，但它们的价值是一样的，都是为了对数据/页面进行分发。在开发独立项目时，有了 vue-router，就不会过重地依赖于后端服务器，而是把路由工作交给前端来做。

有同学会问为什么 `pop` 也能编译通过，说明对于 JS 本身的理解还是不够到位，快去打打基础吧（其实我也不明白为啥，也得补补基础了）。
