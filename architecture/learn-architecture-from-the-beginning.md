# 《从0开始学架构》学习笔记

> 课程链接：https://time.geekbang.org/column/intro/81
> 第二遍阅读时，选出每篇文章的优质留言

---

## 01 | 架构到底是指什么？

> 课程链接：https://time.geekbang.org/column/article/6458

### 系统与子系统

系统：

- 由一群**有关联的个体**（如汽车的发动机、底盘、轮胎等各部分），
- 根据**某种规则运作**（如发动机产生动力，变速器和传动轴传输动力），
- 能完成个别元件不能单独完成的工作的**群体**（系统不是个体能力的简单加和，而是产生新的能力，比如汽车各部分组合起来之后，才能载重前进）。

子系统和系统的定义其实一样，只是观察的角度不同，一个系统可能是另一个更大系统的子系统。

- 比如微信本身是一个大系统，包含聊天、登录、支付、朋友圈等子系统。
- 朋友圈这个系统又进一步包含动态、评论、点赞等子系统。
- 评论这个系统又进一步包含防刷子系统、审核子系统、发布子系统、存储子系统。
- 评论审核子系统不再包含**业务意义上**的子系统，而是包括各个模块或组件，这些模块或组件可能也是另一个维度上的系统。比如 MySQL、Redis 是存储系统，但不是业务子系统。

### 模块与组件

模块和组件其实都是系统的最够深，只是从不同的角度拆分系统而已。

模块 | 组件
------------ | -------------
从**逻辑**的角度拆分系统 | 从**物理**的角度拆分系统
主要为了职责分离 | 主要为了单元复用

比如一个常见的学生信息管理系统：
- 从模块（逻辑）的角度来拆分，可以分为：登录注册模块、个人信息模块、个人成绩模块。
- 从组件（物理）的角度来拆分，可以分为：Nginx、Web 服务器、MySQL。

### 框架与架构

框架：软件组件的规范，比如 MVC、MVP、MVVM、J2EE 等；或者按照规范做出来的、提供基础功能的产品，比如 Spring MVC、Spring JPA 等。

架构：软件系统的**顶层结构**。
- 比如对于由一群关联个体组成的系统，架构用来明确系统包含哪些个体。
- 系统中的个体各自按照规则运作，架构用来明确个体运作和互相协作的规则。
- 用顶层结构来指代架构，可以避免将系统架构和子系统架构相混淆。

要区分两者的不同，再用上面的学生信息管理系统举例：
- 从业务逻辑角度分解，其架构可以分为：登录注册模块、个人信息模块、个人成绩模块。
- 从物理部署角度分解，其架构可以分为：Nginx、Web 服务器、MySQL。
- 从开发规范角度分解，该系统可以用标准的 MVC 框架来开发，因此架构又变成了 MVC 架构。

### TODO

分析公司业务的架构、系统、模块、组件。

---

## 02 | 架构设计的历史背景

> 课程链接：https://time.geekbang.org/column/article/6463

最初的机器语言：太难写、太难读、太难改
→ 汇编语言：易读性显著提升，但编写还是很复杂，且不同 CPU 的汇编指令和结构各不相同
→ 高级语言：无需关注机器底层的结构和逻辑，只需关注具体问题和业务，且可以编译为适合各种 CPU 指令的机器语言
→ 第一次软件危机：1960/1970年代，软件“逻辑”异常复杂：IBM 的 System/360 操作系统开发，投入巨大，进度不断延迟，质量也得不到保障
  → 提出软件工程、结构化程序设计（面向过程：自顶向下、逐步细化、模块化），用于解决软件危机
→ 第二次软件危机：1980年代，软件“扩展”异常复杂：硬件飞速发展，业务需求越发复杂，编程应用领域越发广泛
  → 面向对象思想开始流行
→ 软件系统越来越复杂：1990年代，随着软件系统规模的增加，算法和数据结构不再是主要的设计问题，软件架构才是主要的设计问题

---

## 03 | 架构设计的目的

> 课程链接：https://time.geekbang.org/column/article/6472

架构设计的主要目的：解决软件系统复杂度带来的问题。

### 常见误区

- 需求太多，从哪里下手做架构设计？
- 熟悉和理解需求，识别系统复杂性，针对复杂点做架构设计。

- 架构设计要考虑高性能、高可用、高扩展、时间紧任务重，可能完不成。
- 架构设计并不是要面面俱到，关键是要识别出复杂点，有针对性地解决问题。

- A 公司的架构是 X，B 公司的架构师 Y，我们公司该用哪个呢？
- 理解每个架构方案背后所要解决的复杂点，再根据自己业务的实际复杂点，参考相似的方案。

- 我们的系统要做到 TPS XX 万。
- 如果系统复杂度不在性能上，那么 TPS 做到 XX 万并没有用。

- 淘宝架构是这样，我们也要这样。
- 淘宝的架构是为了解决它的业务复杂度而设计的，绝大多数普通公司业务的用户量和淘宝都是天差地别的。

- Docker 很流行，我们的架构也要用 Docker。
- Docker 不是万能的，只是为了解决资源重用和动态分配而设计的，如果系统复杂度不在这里，就没有必要引入 Docker。

### 复杂度分析案例

设计一个大学的学生管理系统，基本功能包括登录、注册、成绩管理、课程管理等。

对这样一个系统进行架构设计时，首先要识别它的复杂度在哪里。

性能：一个大学的学生大约有 1~2 万人，学生管理系统访问频率不高，平均每天每个学生的访问次数可能不到 1 次，性能这部分不复杂。
存储用 MySQL 完全够了，缓存都可以不用，Web 服务器用 Nginx 也是绰绰有余。

可扩展性：学生管理系统的功能比较稳定，可扩展的空间并不大，可扩展性也不复杂。

高可用：学生管理系统即使宕机 2 小时，对学生管理工作的影响也不大，可以不做负载均衡，更不用说异地多活。
但是如果学生数据全部丢失，修复起来就非常麻烦，只能人工逐条修复，不可接受，所以存储要做到高可靠。
这里有些负责，要考虑多种异常情况：针对机器故障要设计 MySQL 同机房主备方案；针对机房故障要设计 MySQL 跨机房同步方案。

安全性：学生管理系统存储的学生信息有一定的隐私性，但没有达到金融级别，也不包含强隐私（个人照片、情感等）信息。
所以安全性方面做 3 件事就能基本满足要求：Nginx 做 ACL 控制，用户账号密码管理，数据库访问权限控制。

成本：系统很简单，几台服务器就能搞定，对大学来说不是问题，不用太关注。

综上可知，该方案的主要复杂性体现在存储可靠性上，要能保证出现异常时，不要丢失所有数据即可（丢失几十个学生信息问题不大）。

### TODO

分析一下公司业务的复杂度。

---


