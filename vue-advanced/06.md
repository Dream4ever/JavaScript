# 第六课 - 继续深入组件

## 总结

### 面试点

都在官方文档的“基础”中，组件部分的内容会问得比较多。

- 要弄懂组件封装的含义、独立作用域、数据传递、事件交互等方面的含义。
- 单向数据流整个小节的内容。
- 数据通信。

### 学习方法

- 学习一定不要忽冷忽热，一定要每天都钻研一点东西，这样坚持下来，效果更好。

### 重要概念

- 子组件尽量不要修改传入的值。
- 非父子组件的通信。

## 开场

听过昨天的课程之后，今天重新再学习一下文档中“组件”这一部分。如果不让大家先写一写代码，看文档就没有什么效果了。

今天再来看文档，文档前面的部分大家已经可以比较容易理解了。

组件有自己的生命周期，有传入数据的方式，也有抛出事件的方式，不外乎就是代码表现手法方面的问题。

注意：一定要对组件有所认知。要弄懂组件封装的含义、独立作用域、数据传递、事件交互等方面的含义。这都是面试点。

## 全局组件

全局组件的好处是可以随处访问，但是如果这个组件的复用率不高的话，那就没必要抽离成组件了。

一个组件至少重用两次才有抽离成独立组件的意义，不然就放到根实例的 `template` 中就行。

但是有时候抽离出一个组件，并不是为了让至少两个以上组件来使用。抽离组件的目的：

1. 实现组件的共用；
2. 实现页面更好的切分管理。

数据绑定看起来很简单，但是如果标签太长的话，又不能对页面很好地切分管理，代码写起来就太麻烦了。

## 组件命名规范

昨晚在 vue-cli 中编写组件的时候，就没有用短横线分隔式，而是驼峰式。

但是实际开发时，还是要遵循团队的开发规范。

## 单向数据流

面试重点！这一小节一定要精读！

第一段一定要理解。编程时最怕的就是变量到处都可以被修改。函数式编程的理念就是“纯”，Vue 也通过单向数据流解决了这个问题。

看示例：抽离出了一个组件 `task-menu`，通过 `items` 传入值。不管组件想如何操作，组件内千万不要修改传入的值。不然父组件更新之后，子组件中的值又会变化，这个数据就乱了。

非要修改传入的值的话，文档中也提供了两种建议的方式。

在老师看来，单向数据流更像是 Vue 的编码规范。只有通过实战才能体会到这种规范的优缺点。所以一定要自己去看这部分文档，并且写代码，才能有实际的感受。

## Props 验证

JS 最难的一点就是数据的类型是不定的，这是 JS 的缺点之一。只能通过多看代码去品味这件事情，Vue 提供的验证功能就让开发者在写代码的时候非常省心了。

但是 Props 验证的写法不统一就有点烦人了，下面两种写法是完全等价的，你说该用哪种写法呢？是不是很烦人。

```javascript
{
  propA: Number,
  PropB: {
    type: Number
  }
}
```

## 非 Props 特性

指的是可以不用定义 `props` 就能直接传入组件的特性。就像 HTML 不识别自定义属性一样，在组件中没有通过 `props` 定义的属性，也无法在组件中用。尽量不要这样写。

## 自定义事件

目前大家只需要知道怎么在组件中通过中间媒介把事件抛出来，然后让父组件执行对应事件就可以了。知道了这件事，项目中 90% 以上的需求就能搞定了。

### 给组件绑定原生事件

不是有特别的需求的话，这个功能其实用不到。

`v-on:click="xxx"` 绑定的并不是原生事件，而是 Vue 已经封装处理过的事件。如果的确需要处理原生事件的话，写成 `v-on:click.native="xxx"` 就可以了。

文档里这件事讲得也很少，说明它的确也很少用到。有的时候看篇幅就能够大致知道一个知识点重不重要。

## 使用自定义事件的表单组件

这一部分要讲的话，会带出很多 HTML 的知识，这些知识之前还没讲过，这次就先不讲了。

前面讲过，`v-model` 只在表单中才会用到。但有时候在自定义的组件中也会用到这个指令，后面在项目中会讲这个概念。

## 非父子组件的通信

这个知识点很关键。前面讲过父子组件之间的通信，大家应该也都看懂如何实现了。但是非父子组件该如何通信呢？文档中组件的这一部分讲的是用一个空的 Vue 实例作为事件总线（bus）。

从老师个人来讲，并不推荐这种方式。文档中也说了，在复杂的情况下推荐 Vuex，它很好地解决了数据共享的问题。老师也会要求自己的员工在开发时尽量不要用上面的方式解决数据共享的问题，因为上面这种方式不能够很好地保证数据的单向性。

## 插槽内容分发

这是本节课的重点。

虽然前面修改成了组件化的代码，看着挺不错的。但还是有些小问题。在 HTML 标签中，可以在标签内插入内容。那组件中怎样能在标签中插入内容，还能让这个内容被用到呢？

插槽用起来其实很简单，但是文档中说的太复杂了。其实在组件的 `template` 中插入一行 `<slot></slot>` 就可以了，然后在组件的开闭标签之间写内容，就可以显示出来了。

而插槽 `slot` 和模板 `template` 的具体使用场景，就需要大家不断去研究、去品味了。

在讲课的时候，又通过改进代码的过程，让大家体会到了计算属性的意义：一个值依赖于现有的值的时候，用计算属性就可以了，能够随着所依赖的值自动更新，而不需要我们去手动更新。

### 编译作用域

在插槽中，不仅可以写原生 HTML，还可以放一个组件进来用，帅不帅？

而插槽中的组件所用到的数据并不是父组件传入的，而是根实例传入的。关于这个编译作用域的概念，大家要好好看看文档。

### 具名插槽

可以放一个插槽，应该就可以放两个插槽吧？匿名插槽就是默认插槽，其它插槽就必须有名字了，这样才能知道插入的内容在什么位置。

插槽非常好的一个用法：可以定义页面模板，比如分成 header、body、footer 几大块，给各部分的位置都预留好，写好组件之后，放到对应的位置就可以了。

## 预告

下节课就直接讲路由了，大家要去看 vue-router 的文档，后面的课程会不断丰富 todo-list 的功能，就要用到 vue-router。老师会在之前的组件化代码和全新的组件化代码之间不断切换。

## 答疑

### 插槽和组件的区别

组件只能抽离出独立的控件，可以不断地去复用。

插槽和组件就完全不一样了，我们可以在插槽中放任何东西。

在写页面的时候，可以对页面进行限制，让组件都放在对应的槽里面。

抽离组件的把握度在哪里，颗粒度是怎样的，需要很好地衡量。

通过插槽实现了内容的限定之后，页面的整体结构就不会被影响了。而组件只是在细粒度上实现一个功能。

### 实例生命周期钩子和虚拟 DOM

用 `document.getElementById('app')` 能够看到在 `beforeCreate` 阶段 DOM 已经渲染完毕了。

## 题外话

很多人觉得小程序很牛，但是老司机们觉得小程序只是借助开源社区，加上它的商业模式运营出来的一个成功的产品。那么这件事恐怖在哪里呢？昨天在执行 `npm run build` 的时候，它编译出了一堆东西放在 `dist` 里面，而编译出来的这些东西是可以安装的。那就意味着前端代码是可以下载的，是可以**离线**的，那不就和 NativeApp 一样了么？

现在没有这样做的很大一部分原因是因为技术还没普及，而且网络还不够发达。但这个趋势就是未来。

## 总结

Vue 中的内容已经讲完了，没讲的部分大家要自己去看。重要的是组件该如何使用，该如何配合后面的路由使用。

文档如何看：

- 基础部分全部要搞定。
- 过渡 & 动画不用管，在工作中提高就可以了。
- 可复用性 & 组合，这些知识会融入到老师不断改进的项目中。
- 其余的部分：掌握好基础之后再稍微看看就行。
- 规模化：这里面的三大部分都很重要：路由、状态管理、服务端渲染。

Vue-Router 和 Vuex 都要融入项目来学。Vue-Router 这个插件不算太大，但是 Vuex 很大，后面两节课会在项目中讲它们，可能会辛苦一些，所以要好好预习。

这两个插件会在 vue-cli 创建的项目中去用，传统的项目没法用它们，因为传统的项目都不是一个工程体系。

PS：学习一定不要忽冷忽热，一定要每天都钻研一点东西，这样坚持下来，效果更好。
