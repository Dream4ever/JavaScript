# 第十节课 - 如何更好地工作，以及社区项目的部署

## 心得分享

老徐最近很忙，也感受到了各种压力。

第一件事情就是要做产品那边的需求，还得尽快完成需求。

第二件事就是改造既有的系统，原来的系统扩展性很差，现在要想办法让它更灵活，未来才能更好地承载更多业务。

第三件事就是既有项目的维护。

这三件事都很重要，如果同时来做的话就会很乱，所以要采取一定的手段才能把它们都做好。因此最近花了很多时间思考这件事，每天也做到很晚。很多人遇到这种情况时就会不知所措，下面就来说说徐老师的方法：

### 一、思考“有效性”

要对公司的人员进行调整。公司这么多人，为什么工作做得不够好？每个人的产出如何？从这个角度去思考，跟每个同事聊聊，看看大家是否清楚自己的目标。聊完之后发现大家普遍是劳而无功，有劲使不上。所以徐老师这三周总结了一个东西，把它分享给正在工作的人：如果能在最开始工作的时候就意识到一件事，怎样让自己的工作有尽量高的有效性，不断带着这样的思考去工作的话，一定会有飞速的成长的。

举个例子，互联网行业都有个特点，都是靠大脑来产出生产率，也就是把知识转换为技能的路线，拿知识变现。这个变现并不是金钱上的，而是把它变成隐形的“资本”。而在传统行业中，比如富士康，招了几十万员工，是靠体力上的劳动力变现。而劳动力变现和知识变现的衡量标准是完全不一样的。劳动力变现可以用数量作为指标进行衡量，知识变现就没法用数量去衡量了。比如有的人每天写一万行代码，有的人却只有十行代码。但是这十行代码对系统的改进有很大的效果，一万行代码反而没法给系统带来多大改进。那么要如何衡量知识变现这件事呢？如何能让大家更主动地去做好工作？本质上就是**有效性**。

对管理者来说，每天喝喝茶抽抽烟，但是他每天的决策都决定公司的方向。作为员工也要每天去想如何决定工作正确的方向。一定要在开始干活之前把这件事想明白，想清楚如何更高效地写代码，然后才去写代码，这样才能事半功倍。而在实际工作中，没有什么思考就去做事的人其实是绝大多数，说比例至少占到了 80% 都不为过。

学习也是如此，要想想自己怎样学习才能真正带来价值。真的是单纯地练习一万小时就能成为专家么？不可能的。这个理论的成立，要建立在一万小时的练习都是深入思考之后的行动的基础上的。要让自己每天的代码都是自己目前能写出来的质量最高的代码，这样才能不断进步。

### 二、相信别人

昨天请同事吃饭，发现他和人聊天时总是有隔阂，有堵看不见的墙在那里。这个同学是一个典型，他在合作上完全不信任别人，只是做好自己的事情，这样的人在团队里是没有价值的，因为团队是一个集体。而一个人如果在工作的时候不能很好地合作，那么这样一个人是做不好工作的。

大家在合作的时候，应该无限地相信别人，大家互帮互助，共同进步。

做技术管理，其实也是在管人，这件事情其实也是很有意思的。

### 三、学会“控制”老板

很多同学刚工作几年的时候，总会觉得老板为什么那么闲，只会安排工作，自己却没什么事。

徐老师以前其实控制欲很强，因为非常自信，所以希望把控所有细节。这种状态在管理十人以内的团队还行，人再多就 hold 不住了，就没办法把控所有细节了，会把自己玩死的。因此徐老师之后就转变了自己的工作方法，把具体执行工作的权力交给大家，只需要知道每个人的决定并不会影响整体的工作就可以了。

有很多同学喜欢控制欲很强、工作要求非常细的 leader，如果换个 leader，他就不知道怎么工作了。徐老师的团队成员现在就是这么个状态，大家都在等老徐的时间，而老徐又在等大家的时间，这就尴尬了，哈哈。

这也是工作多年之后的一个总结：如果 leader 的控制欲很强，希望大家不要被这样的 leader 带偏，一定要有自己的思考能力，这样才能适应未来可能的变化。尤其是公司不断发展壮大之后，越高层的 leader 控制欲越不强，希望下属可以做决策，然后自己根据下属的决策再做自己的决策。

所以希望大家也有自己的判断，以自己的能力多久能做完，心里要有个数。

## 开心的事

小沈同学的妈妈终于被说服啦！不过还有个难题就是毕业设计，大家如果有好的建议可以给他的话就多多帮助他吧。

## community 项目部署

### 简介

今天不讲 Vue，只讲怎么把老师的 community 项目部署、运行起来。

首先，不管部署什么项目，都要仔细阅读 README.md。

老师的 README 里面列出了三个依赖。对于玩票的项目来说，可以用最新的 Node.js，因为能体验到最新的技术嘛。对于正规的项目来说，则会用稳定版本。大家也要这样，正式的项目尽量用稳定版本。

老师也装了 PM2，它可以在程序意外崩溃的时候自动重启，而且它还可以管理多个项目，很方便。

为什么数据库还有 Redis？它是把常用的数据库放在内存缓存里，这样会更快地响应 I/O 请求。

### 配置

#### index.dev.js

clone 项目到本地之后，还需要修改 `src/config/index.dev.js`，把 Webpack 配置成符合自己的需求。

`index.default.js` 则保存的是默认设置，这样一旦配置错了就可以用默认设置覆盖回来。

下面讲讲 `index.dev.js` 中的各项配置的含义：

- `api` 字段中的 `serverUrl` 设置的是服务要放到什么域名上。
- `keywords` 会把字段里的值放到 HTML 同名的 `meta` 标签中的，`headers` 也是如此。
- `logo` 放的就是网站 logo 图片的地址。
- `session` 之类的要改成什么 key 呢？而且还不能让大家猜到呢？网页崩了，后面再讲讲吧……最后也没再讲，哈哈。
- `fileLimit`，限制所上传图片的尺寸。可以设置 10MB，因为现在手机的像素都很高。老师的项目实际用的是 2MB，因为毕竟社区的用户很多，上限要设置的低一些。
- `apiPrefix` 设置的是 API 的前缀。`page` 没设置，`data` 设置的则是 `/api/v1`，这样就知道是在请求数据，graphql 就不动了，用默认的就行。
- `mdType` 字段的值是 markdown 在 HTML 中的类名（class="xxx"）。
- `postListCount` 和 `replyListCount` 设置的是文章和回复数据的分页单位。
- `signinValid` 表示是否开放登录，设置为 `false` 表示只允许通过 GitHub 第三方登录。
- `admin` 是管理员账号的各种设置。
- `email` 是邮件发送的设置。
- `mongodb` 是 MongoDB 数据库的设置。
- `redis` 的默认端口是 6379，徐老师会改成别的是因为 Docker 会默认映射到别的端口。
- `upload` 设置的文件上传路径。
- `qn` 设置的是七牛的 API 相关的数据，徐老师的程序中是将图片直接上传到七牛的，所以要设置它的 API，大家也可以去申请自己的七牛账号，会送空间。这个属性中的 `bucket` 字段则是命名的存储空间，便于管理。
- `github` 是 GitHub 相关的数据。在 GitHub 上设置回调 URL 的时候，就按 `pageRouter` 中的设置来填写。
- `googleAnalytics` 是 Google 分析的代码，添加了就可以方便在 Google 上搜索到网站内容了。

### 运行

首次运行之后，浏览器中什么都没有，查看终端发现程序已经崩溃了。应该是数据库还没有安装，那就按照徐老师在社区的文章，在 Docker 中快速启动一个 MongoDB。

为了测试 MongoDB 是否成功启动，在终端中执行 `mongo` 指令看输出结果，能够判断是否成功连接到数据库服务端。

一直没配置成功，徐老师就从现在正在运行的 community 项目中把已经写好的配置文件复制一份过来。诶哟哟哟，差点儿让大家看到内容，好险好险。

这个配置文件非常重要，千万别把它上传到 GitHub 上了，不然可就危险了。

配置文件复制过来之后再连接，竟然提示 `auth failed`。

电脑卡了，后面似乎没配置成功？那就解读一下项目中的各个目录/文件。

### 功能解读

#### 路由

路由部分有两个，`pageRouter` 用于展示各个页面，对应的是 `controllers` 中的各个模块，每个模块里则是 render 一个个的页面，这不就是之前做的 Express 项目嘛。

话说，为什么老师的项目中，函数参数里面没有 `next` 呢？因为老师用不到嘛。但是第一个参数 `req` 不能去掉，因为 Express 的第一个参数默认就是 `req`，写成 `res` 也没用哦。

`dataRouter` 则开放了各种接口用于数据的处理，并且老师也都分好类了。

阅读这个项目，首先就要看这两个路由，看看提供了哪些功能。

#### controllers

核心的处理逻辑则都在 `controllers` 里面，并且做好了分类。需要改造什么功能就去对应的文件中改就行了。

看代码的时候要形成一种思维：要关注关键字，这样能够迅速知道这段代码的功能。因为并不是任何情况下都需要仔细阅读每一行代码。

- 比如 `user` 中的 `one` 就是用于查找用户，`patch` 则是用于修改用户的信息。
- `at` 是为了解析回复中的 `@` 功能的。
- `cache` 是用来把内容放到缓存里面的。
- `logger` 用于把日志放到文件里面，以便之后分析。
- `marked` 用来把原始的 markdown 解析成 HTML 文本。
- `pages` 是用来处理分页功能的。
- `redis` 就是 `cache` 要用到的，`redis` 将 Redis 进行了封装，来方便使用。
- `upFile` 是用来上传文件的。

#### components

服务端渲染的速度很快，而且服务端渲染能够让百度、Google 等搜索引擎抓取到页面。`components` 中的两个类就是用来提供这个服务的。

#### core

`auth` 是用来验证用户的，验证是否登录、是否管理员。这里的验证功能用到了 JWT。

建议大家一定要去看看 JWT，面试的时候有可能会问到它。它是用来加密登录相关的信息的，加密算法就要用到 JWT。客户端从服务端拿到的加密的 token，之后每次客户端向服务端发送请求的时候都会带上这个 token，服务端就可以对客户端的请求进行验证。

#### data

这里可以不看，用到了 `GraphQL` 这个数据库，它其实对 MongoDB 数据库进行了抽象化，让用户访问数据库更加简单，也减轻了数据库的负担。GraphQL 非常强，它的重要性不亚于 Vue/React。

在 `data` 这个文件夹里，老师只是拿它来试了几个接口。有了自己的项目就可以像这样尽情地尝试新东西，好不好玩？

#### functions

这里封装了函数式编程的方法，提炼出来了和业务相关的功能。

#### middlewares

把中间件一个个都放在了这里。

#### views

- template 放的就是各个页面模板。
- zone 设置的其实就是各个板块。

## 题外话

老师的这个项目自己也会经常打开，打开之后就抄里面的代码。因为老师学到新的东西之后就会应用到这个项目里面，之后再做别的项目需要类似的需求的时候，就会来这里抄一把。

在面试前端职位的时候，对方也是一定会问服务端知识的。会服务端的话是会加分的，很可能就要你了。

明天徐老师有事，估计不讲课了。以后徐老师会让自己的前端团队每周和大家分享一下。

学框架不用学太多，先把一个框架玩得很熟了再说。徐老师前几天和一个中级前端聊天，发现前端工程师在发展过程中往往会把自己给搞蒙了。大师兄的习惯也很不好，广度上可以不断去拓展，但是在实际学习和专注度上，**一定是要先做透一件事的**。不然只是泛泛地知道很多名词，但没有一个熟练的东西，这样是很危险的。即使是专业的前端，也没遇到过比徐老师对 Bootstrap 更熟练的，三年没换过框架，看文档，看源码，用各种版本的 Bootstrap 框架。这是为了说：一定要先把一件事、一个框架学透，然后再学其它框架，才能看出各家的长处短处。

现在徐老师遇到的 Bootstrap 框架上的问题都是很难的，所以都是去 Bootstrap 专业的讨论组里讨论专业的问题的。学东西就是这样，先精通一两个再说。比如说就要坚定不移的用 Vue、用 Vuex，公司开发业务追求稳定，没太多机会去学习各种新鲜事物的。为了让大家能够做好工作的同时，还能够不断尝试新技术，徐老师会让大家拿不重要的项目试水，重要的项目必须用稳定成熟的技术。

所以还是那句话，学习的时候一定要先把最关键的东西学扎实，然后再去想别的事情。

大家一定要努力，后面的机会是很多的。

最后还是建议大家把项目部署起来，可以在不懂代码的时候先把项目运行起来，放到自己的网站上，也是一件很有意思的事情。

最后再强调一下，前面半小时讲的如何更有效地工作，如何去理解上级和下属之间的理解、信任、工作，如何去控制领导而不是被领导控制，这三点是非常重要的。
