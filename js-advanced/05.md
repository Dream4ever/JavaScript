# 第五课 - 往期课程内容梳理

## package.json

这个文件是 Node.js 项目的关键点之一，里面所包含的 `scripts`、`dependencies` 等等字段，是项目的关键信息。

而对于 GitHub 上的各种项目来说，不管用的是什么编程语言，`README.md` 都是项目的关键说明。

## Express.js

为什么要把它全局安装在电脑中？因为这样一来，可以随时随地生成一个工程/项目，相当于一个脚手架——可以在这个基础上，去做各种各样的功能。

这样的一个脚手架会包含什么呢？

```sh
|
|-bin/www
|-app.js —— 大佬
|-views
|-public
|-routes
```

在掌握了这个结构之后，就可以往这个框架合适的地方填充自己的代码了。

## Express 执行流程

从 `www` 开始执行。

然后加载 `app.js`。

`app.js` 中会有各种各样的中间件。

接着通过“路由”这个中间件，将请求分发到对应的路由上，比如 index、users。这个时候，才是真正要去实现逻辑的地方，路由将请求传给模板文件或者进行其它的处理，然后将请求返回。

还有一个非常重要的，就是 `next`。

除了 `next`，还有很重要的就是 `res` 和 `req`。

用户发进来的请求，都是散漫的。而工程师就要把用户这些散漫的数据，统一抽象到 `req` 这个对象里。把传入的数据处理完成之后，再根据实际需求，把数据抽象到 `res` 里面，返回给用户。

简单来说，就是：

- client 发数据。
- Express 把请求数据封装到 req：比如 `req.body`、`req.query`，这些都是封装进来的数据。
- Express 对数据进行对应的处理。
- Express 把响应数据封装到 res：比如 `res.render`、`res.send` 这些用于处理响应的方法。

而不管是上面哪种处理，都需要 `next` —— 这就是它的重要之处：将上一步的处理结果交给下一步。

## 路由

通过老师的演示可以看出，每一次的请求都是从上往下依次找一遍，所以访问 `/posts` 时，会先在 `/` 的 `/api/posts` 里面找一下，不匹配，然后再去 `/posts` 中找，找着了，OK，处理路由。

```javascript
app.use('/', function (req, res, next) {
    console.log('process 1 = ' + req.path);
    next();
}, page);

app.use('/posts', function (req, res, next) {
    console.log('process 2 = ' + req.path);
    next();
}, api);
```

API 一般都是用来提供数据的，可以搭配 `res.json()`、`res.send()` 来使用。

老师的示例中，将 page 与 api 分离开来，各司其职，修改其中一个功能也不会影响到另外一个功能，这是一种很好的开发习惯。

为什么要命名为 `route.page.js`？因为这样很形象，一眼就能看出来文件的作用，而且也便于处理文件。

### 题外话

为什么 `app.js` 中，比如路由这里的代码没有 `req`、`res`、`next`，也能正常往下执行呢？

因为路由文件中，用的就是 `Router` 对象，而框架中的这个对象，会将传入的请求用 HTTP 方法处理完成之后，再用里面的 `function(req, res, next) { ... }` 将请求往下传。

这样的一种处理流程，能够让开发者更关注于业务逻辑，而不用太关注于琐碎的流程处理。

两个路由文件中导出的都是 `router`，不会冲突么？

因为 JS 是一门函数式编程语言，不管导出的是什么对象，本质上处理的都是一个个的函数，而这些函数之间不会有冲突，因为大家各司其职。所以两个路由文件处理的是不同的路由，是两个不同的函数，因此即使导出的都是 `router` 也不会冲突。

## 渲染时机

在浏览器中请求 `localhost:3000`，Express.js 可以在服务端渲染生成 `index.html` 然后返回浏览器。服务器通过 EJS 这样的模板引擎来渲染 HTML，这样渲染工作就在服务端完成了。

还有一种情况：返回的 HTML 文件中的 `script` 标签里包含了 JS 文件，该文件向后端请求数据，获取到数据之后，利用 Vue 在前端将数据渲染成页面上的内容，这就是客户端渲染。

## 数据库之争

json-server 并不是数据库，可以实现简单的数据存取，比如做一个打卡程序。而数据库是用于查询的，比如要从百万、千万条数据中查询，这个时候就需要用数据库了。

## 为什么要用 JSON？

因为在客户端和服务端之间传递数据时，JSON 比较方便。但是 JSON 相对来说，流量会用得多一些。不过现在的网络带宽让大家已经不用太关注流量了，所以 JSON 目前支持非常广泛。
